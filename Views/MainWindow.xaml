<Window x:Class="Wpf_RunVision.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:hc="https://handyorg.github.io/handycontrol"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:Release="clr-namespace=VMControls.WPF.Release;assembly=VMControls.WPF"
        xmlns:vm="clr-namespace:Wpf_RunVision.ViewModels"
        mc:Ignorable="d"
        Title="RunVision"
        MinHeight="450"
        MinWidth="800"
        Height="800" Width="1300"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized">

    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Closed">
            <i:InvokeCommandAction Command="{Binding WindowClosedCommand}" />
        </i:EventTrigger>
    </i:Interaction.Triggers>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 菜单栏 -->
        <Menu Grid.Row="0">
            <MenuItem Header="软件设置" IsEnabled="{Binding CanEditScheme}">
                <MenuItem Style="{x:Null}" Header="方案配置" Command="{Binding OpenSchemeCommand}"/>
            </MenuItem>

            <MenuItem Header="{Binding CurrentPermission}" Command="{Binding TogglePermissionCommand}" />

            <MenuItem Header="{Binding CurrentScheme}">
                <MenuItem.ItemsSource>
                    <Binding Path="Schemes"/>
                </MenuItem.ItemsSource>
                <MenuItem.ItemContainerStyle>
                    <Style TargetType="MenuItem">
                        <Setter Property="Header" Value="{Binding}" />
                        <Setter Property="Command" 
                                Value="{Binding DataContext.SwitchSchemeCommand, RelativeSource={RelativeSource AncestorType=Window}}" />
                        <Setter Property="CommandParameter" Value="{Binding}" />
                    </Style>
                </MenuItem.ItemContainerStyle>
            </MenuItem>
        </Menu>

        <!-- 主内容区 -->
        <Grid Grid.Row="1" Background="{DynamicResource {x:Static SystemColors.MenuBrushKey}}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- 左侧主界面显示区域 -->
            <Border Grid.Column="0">
                <ContentControl Content="{Binding FrontendControl}" />
            </Border>

            <!-- 中间分割条 -->
            <GridSplitter Grid.Column="1"
                          Width="1"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Stretch"
                          ResizeDirection="Columns"
                          ResizeBehavior="PreviousAndNext"
                          Background="Transparent"
                          ShowsPreview="True"/>

            <!-- 右侧状态面板 -->
            <hc:SimplePanel Grid.Column="2" Margin="2,0,2,0"
                            Background="{DynamicResource RegionBrush}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="250"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- 上方状态与进度 -->
                    <Border Grid.Row="0" Margin="0,2,0,2"
                            BorderThickness="1" BorderBrush="{DynamicResource BorderBrush}"
                            Background="{DynamicResource RegionBrush}"
                            CornerRadius="4">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2.5*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- 左侧：码信息 + 状态 -->
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- 蚀刻码 & 纸质码 -->
                                <Border Grid.Row="0" Grid.ColumnSpan="2" Style="{StaticResource BorderRegion}" Margin="5" Padding="5">
                                    <StackPanel Orientation="Vertical" HorizontalAlignment="Left">
                                        <TextBlock Style="{StaticResource TextBlockLargeBold}" HorizontalAlignment="Left" FontSize="12" Margin="5,5,0,0">
                                            <Run Text="蚀刻码:"/>
                                            <Run Text="{Binding ViewState.EtchingCode}"/>
                                        </TextBlock>
                                        <TextBlock Style="{StaticResource TextBlockLargeBold}" HorizontalAlignment="Left"  FontSize="12" Margin="5,5,0,0">
                                            <Run Text="纸质码:"/>
                                            <Run Text="{Binding ViewState.PaperCode}"/>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>

                                <!-- 左下：状态信息 -->
                                <Grid Grid.Row="1">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <Border Grid.Column="0" Style="{StaticResource BorderRegion}" Margin="5,0,5,5" Padding="5">
                                        <StackPanel Orientation="Vertical" HorizontalAlignment="Left"/>
                                    </Border>

                                    <Border Grid.Column="1" Style="{StaticResource BorderRegion}" Margin="0,0,5,5" Padding="5">
                                        <StackPanel Orientation="Vertical" HorizontalAlignment="Left"/>
                                    </Border>

                                    <Border Grid.Column="2" Style="{StaticResource BorderRegion}" Margin="0,0,5,5" Padding="5">
                                        <StackPanel Orientation="Vertical" VerticalAlignment="Top" HorizontalAlignment="Left">
                                            <TextBlock Style="{StaticResource TextBlockDefaultSuccess}" HorizontalAlignment="Left" FontSize="14" Margin="5,5,0,0">
                                                <Run Text="数据库:"/>
                                                <Run Text="{Binding ViewState.DbStatus}"/>
                                            </TextBlock>
                                            <TextBlock Style="{StaticResource TextBlockDefaultSuccess}" HorizontalAlignment="Left" FontSize="14" Margin="5,5,0,0">
                                                <Run Text="PLC:"/>
                                                <Run Text="{Binding ViewState.PlcStatus}"/>
                                            </TextBlock>
                                            <TextBlock Style="{StaticResource TextBlockDefaultDanger}" HorizontalAlignment="Left" FontSize="14" Margin="5,5,0,0">
                                                <Run Text="MES:"/>
                                                <Run Text="{Binding ViewState.MesStatus}"/>
                                            </TextBlock>
                                            <TextBlock Style="{StaticResource TextBlockDefaultSuccess}" HorizontalAlignment="Left" FontSize="14" Margin="5,5,0,0">
                                                <Run Text="存图网盘:"/>
                                                <Run Text="{Binding ViewState.NasStatus}"/>
                                            </TextBlock>
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </Grid>

                            <!-- 右侧：进度与时间 -->
                            <Grid Grid.Row="0" Grid.Column="1">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- 进度条 -->
                                <Border Grid.Row="0" Style="{StaticResource BorderRegion}" Margin="0,5,5,5" Padding="5">
                                    <StackPanel Orientation="Vertical">
                                        <hc:CircleProgressBar Value="{Binding ViewState.ProgressValue}" 
                                                              Margin="5" Width="100" Height="96" ArcThickness="20"
                                                              Style="{StaticResource ProgressBarSuccessCircle}"/>
                                        <Slider Value="{Binding ViewState.ProgressValue}" Maximum="100"/>
                                    </StackPanel>
                                </Border>

                                <!-- 时间信息 -->
                                <Border Grid.Row="1" Style="{StaticResource BorderRegion}" Margin="0,0,5,5" Padding="5">
                                    <StackPanel Orientation="Vertical" VerticalAlignment="Center" HorizontalAlignment="Left">
                                        <TextBlock Style="{StaticResource TextBlockLarge}" HorizontalAlignment="Left" FontSize="12" Margin="5,5,0,0">
                                            <Run Text="总运行时常:"/>
                                            <Run Text="{Binding ViewState.RunTime}"/>
                                        </TextBlock>
                                        <TextBlock Style="{StaticResource TextBlockLarge}" HorizontalAlignment="Left" FontSize="12" Margin="5,5,0,0">
                                            <Run Text="CT总耗时:"/>
                                            <Run Text="{Binding ViewState.CtTime}"/>
                                        </TextBlock>
                                        <TextBlock Style="{StaticResource TextBlockLarge}" HorizontalAlignment="Left" FontSize="12" Margin="5,5,0,0">
                                            <Run Text="单次流程耗时:"/>
                                            <Run Text="{Binding ViewState.SingleFlowTime}"/>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>
                            </Grid>
                        </Grid>
                    </Border>

                    <!-- 下方日志显示 -->
                    <Border Grid.Row="1" Margin="0,3,0,2"
                            BorderThickness="1" BorderBrush="{DynamicResource BorderBrush}"
                            Background="{DynamicResource RegionBrush}"
                            CornerRadius="4">
                        <RichTextBox x:Name="LogRichTextBox"
                                     BorderThickness="0"
                                     IsReadOnly="True"
                                     VerticalScrollBarVisibility="Auto"/>
                    </Border>
                </Grid>
            </hc:SimplePanel>
        </Grid>
    </Grid>
</Window>
