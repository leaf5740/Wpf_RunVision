<Window x:Class="Wpf_RunVision.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:hc="https://handyorg.github.io/handycontrol"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:Release="clr-namespace=VMControls.WPF.Release;assembly=VMControls.WPF"
        xmlns:local="clr-namespace:Wpf_RunVision.Converters"
        xmlns:vm="clr-namespace:Wpf_RunVision.ViewModels"
        mc:Ignorable="d"
        Title="RunVision"
        MinHeight="450"
        MinWidth="800"
        Height="800" Width="1300"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized">

    <!-- 关闭窗口时调用 WindowClosedCommand -->
    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Closed">
            <i:InvokeCommandAction Command="{Binding WindowClosedCommand}" />
        </i:EventTrigger>
    </i:Interaction.Triggers>

    <!--<Window.Resources>
        <local:InverseBoolConverter x:Key="InverseBoolConverter"/>
    </Window.Resources>-->

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- 第一行：菜单栏 -->
            <RowDefinition Height="*"/>
            <!-- 第二行：主内容区域 -->
        </Grid.RowDefinitions>

        <!-- ================= 顶部菜单栏 ================= -->
        <Menu Grid.Row="0">
            <!-- 方案配置菜单 -->
            <MenuItem Header="软件设置" IsEnabled="{Binding CanEditScheme}">
                <MenuItem Style="{x:Null}" Header="方案配置" Command="{Binding OpenSchemeCommand}"/>
            </MenuItem>

            <!-- 权限菜单 -->
            <MenuItem Header="{Binding CurrentPermission}" Command="{Binding TogglePermissionCommand}" />

            <!-- 方案切换菜单 -->
            <MenuItem Header="{Binding CurrentScheme}">
                <MenuItem.ItemsSource>
                    <Binding Path="Schemes"/>
                </MenuItem.ItemsSource>
                <MenuItem.ItemContainerStyle>
                    <Style TargetType="MenuItem">
                        <Setter Property="Header" Value="{Binding}" />
                        <Setter Property="Command" 
                    Value="{Binding DataContext.SwitchSchemeCommand, RelativeSource={RelativeSource AncestorType=Window}}" />
                        <Setter Property="CommandParameter" Value="{Binding}" />
                    </Style>
                </MenuItem.ItemContainerStyle>
            </MenuItem>

        </Menu>

        <!-- ================= 主内容区 ================= -->
        <Grid Grid.Row="1" Background="{DynamicResource {x:Static SystemColors.MenuBrushKey}}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <!-- 左侧区域，占2份 -->
                <ColumnDefinition Width="Auto"/>
                <!-- 中间分隔条 -->
                <ColumnDefinition Width="*"/>
                <!-- 右侧区域，占1份 -->
            </Grid.ColumnDefinitions>

            <!--左侧-->
            <Border Grid.Column="0">
                <!-- 前端控件容器 -->
                <ContentControl Content="{Binding FrontendControl}" />
            </Border>



            <!-- 分隔条：可拖动调整左右区域宽度 -->
            <GridSplitter Grid.Column="1"
                          Width="1"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Stretch"
                          ResizeDirection="Columns"
                          ResizeBehavior="PreviousAndNext"
                          Background="Transparent"
                          ShowsPreview="True"/>

            <!-- 右侧：HandyControl 的 TabControl，用于切换设备信息和日志 -->
            <hc:TabControl Grid.Column="2" Margin="0,0,2,0"
                           ShowContextMenu="False"
                           IsAnimationEnabled="True"
                           ShowCloseButton="False"
                           IsDraggable="True"
                           IsTabFillEnabled="True"
                           >

                <!-- 设备信息标签页 -->
                <hc:TabItem Header="设备信息" IsSelected="True">
                    <hc:SimplePanel Background="{DynamicResource RegionBrush}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="250"/>
                                <!-- 顶部固定高度 -->
                                <RowDefinition Height="Auto"/>
                                <!-- 中间自适应 -->
                                <RowDefinition Height="*"/>
                                <!-- 剩余空间 -->
                            </Grid.RowDefinitions>
                            <Border Grid.Row="0" Margin="0,2,0,2"
                                    BorderThickness="1" BorderBrush="{DynamicResource BorderBrush}"
                                    Background="{DynamicResource RegionBrush}"
                                    CornerRadius="4"/>
                        </Grid>
                    </hc:SimplePanel>
                </hc:TabItem>

                <!-- 日志标签页 -->
                <hc:TabItem Header="日志">
                    <RichTextBox Name="LogRichTextBox"
                                 BorderThickness="0"
                                 IsReadOnly="True"
                                 VerticalScrollBarVisibility="Auto"/>
                </hc:TabItem>

            </hc:TabControl>
        </Grid>
    </Grid>
</Window>
