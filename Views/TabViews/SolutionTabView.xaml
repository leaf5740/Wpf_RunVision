<UserControl x:Class="Wpf_RunVision.Views.TabViews.SolutionTabView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Wpf_RunVision.Views.TabViews"
             xmlns:vm="clr-namespace:Wpf_RunVision.ViewModels.TabViewModels"
             xmlns:hc="https://handyorg.github.io/handycontrol"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800">
    <UserControl.DataContext>
        <vm:SolutionTabViewModel/>
    </UserControl.DataContext>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2.5*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 方案流程列表 -->
        <GroupBox Grid.Column="0" Header="方案流程" Style="{StaticResource GroupBoxTab}" Margin="5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
            
            
                <!-- 流程数据表格（确保绑定的是FlowStepModel自身属性） -->
                <DataGrid 
                    Grid.Row="0"
                    HeadersVisibility="All"
                    RowHeaderWidth="35"
                    hc:DataGridAttach.ShowRowNumber="True"
                    AutoGenerateColumns="False"
                    CanUserSortColumns="False"
                    ItemsSource="{Binding FlowSteps}"
                    SelectedItem="{Binding SelectedFlowStep, Mode=TwoWay}"
                    CanUserAddRows="False"
                    SelectionMode="Single"
                    Margin="0,0,0,5"
                    RowHeight="30">
                    <DataGrid.Columns>
                        <DataGridTextColumn Binding="{Binding StepName}" Header="流程名称" IsReadOnly="True"/>
                        <DataGridTextColumn Binding="{Binding Pcs}" Header="Pcs"/>
                        <DataGridTextColumn Binding="{Binding ImageIndex}" Header="图片索引"/>
                        <DataGridTextColumn Binding="{Binding Remark}" Header="备注"/>
                    </DataGrid.Columns>
                </DataGrid>
                <Expander Grid.Row="1" Header="总PCS排序">
                    <Border Height="300" BorderThickness="1,0,1,1" BorderBrush="{DynamicResource BorderBrush}" Background="{DynamicResource RegionBrush}" CornerRadius="0,0,4,4">
                        <TextBox
                            VerticalAlignment="Top"
                            Text="{Binding PcsSorting, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            hc:InfoElement.Placeholder="请输入检测运行排序后PCS，例如64,36,42,1,2,3"
                            Style="{StaticResource TextBoxExtend}"
                            BorderThickness="0,0,0,0"
                            TextWrapping="Wrap"  
                            VerticalScrollBarVisibility="Auto"
                            HorizontalScrollBarVisibility="Auto"
                            MinHeight="50" FontSize="14" />

                    </Border>
                </Expander>
            </Grid>
        </GroupBox>

        <!-- 右侧配置区（绑定ViewModel的属性，而非FlowStepModel） -->
        <Grid Grid.Column="1" Margin="30,15,30,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- 总PCS（绑定ViewModel的TotalPcs，而非FlowStepModel） -->
            <TextBox Grid.Row="0"
                     hc:InfoElement.Title="总PCS:"
                     Text="{Binding TotalPcs, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                     hc:InfoElement.Placeholder="请输入正整数（如：100）"
                     Style="{StaticResource TextBoxExtend}"
                     Margin="0,0,0,10"/>

            <!-- 总图片数量（绑定ViewModel的TotalImages，而非FlowStepModel） -->
            <TextBox Grid.Row="1"
                     hc:InfoElement.Title="总图片数量:"
                     Text="{Binding TotalImages, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                     hc:InfoElement.Placeholder="请输入正整数（如：20）"
                     Style="{StaticResource TextBoxExtend}"
                     Margin="0,0,0,10"/>

            <!-- 方案流程选择 -->
            <ComboBox Grid.Row="2"
                      hc:InfoElement.Title="方案流程:"
                      ItemsSource="{Binding FlowTypes}"
                      SelectedItem="{Binding SelectedFlowType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                      Style="{StaticResource ComboBoxExtend}"
                      Margin="0,0,0,10"
                      IsSynchronizedWithCurrentItem="False"/>

            <!-- 图片里的Pcs -->
            <TextBox Grid.Row="3"
                     hc:InfoElement.Title="图片里的Pcs:"
                     Text="{Binding ImagePcs, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                     hc:InfoElement.Placeholder="请输入正整数（如：5）"
                     Style="{StaticResource TextBoxExtend}"
                     Margin="0,0,0,10"/>

            <!-- 图片索引 -->
            <TextBox Grid.Row="4"
                     hc:InfoElement.Title="图片索引:"
                     Text="{Binding ImageIndexRule, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                     hc:InfoElement.Placeholder="索引示例：1,3,5,"
                     Style="{StaticResource TextBoxExtend}"
                     Margin="0,0,0,10"/>

            <!-- 分隔线 -->
            <hc:Divider Grid.Row="5"
                        LineStrokeThickness="1"
                        Orientation="Horizontal"
                        Margin="0,0,0,10"/>

            <!-- 添删按钮组 -->
            <Grid Grid.Row="6" Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0"
                        Content="删除"
                        Command="{Binding DeleteSelectedFlowStepCommand}"
                        Width="90"
                        Height="35"
                        HorizontalAlignment="Left"/>

                <hc:Divider Grid.Column="1"
                            LineStrokeThickness="2"
                            LineStroke="{DynamicResource DarkPrimaryBrush}"
                            Orientation="Vertical"
                            MaxHeight="16"
                            HorizontalAlignment="Center"/>

                <Button Grid.Column="2"
                        Content="添加"
                        Command="{Binding AddFlowStepCommand}"
                        Height="35"
                        Width="90"
                        HorizontalAlignment="Right"/>
            </Grid>

            <!-- 保存配置按钮 -->
            <Button Grid.Row="7"
                    Height="40"
                    Content="保存配置"
                    Command="{Binding SaveConfigCommand}"
                    HorizontalAlignment="Stretch"/>
        </Grid>
    </Grid>

</UserControl>